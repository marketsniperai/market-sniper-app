# MASTER CONTEXT PACK (OMSR)

## UPDATE PROTOCOL
> **Protocol:** REGENERATE_ONLY
> **Update Rule:** This pack is regenerated, not edited by hand.
> **Source Rule:** Every section must include source attribution.
> **Invalidation:** If a source changes, this pack is invalid until refreshed.
> **Stamp:** `9e12ff4` (2026-02-06)

---

# PART I: MACHINE INDEX
> **Purpose:** High-density context for automated ingestion.

## 1. Canon Manifest (Paths)
- `docs/canon/PRINCIPIO_OPERATIVO__MADRE_NODRIZA.md`
- `docs/canon/SYSTEM_CONTRACT.md`
- `docs/canon/CONTEXT_CORE.md`
- `docs/canon/SYSTEM_LAWS.md`
- `docs/canon/SYSTEM_ATLAS.md`
- `docs/canon/OS_MODULES.md`
- `docs/canon/MAP_CORE.md`
- `docs/canon/ANTIGRAVITY_CONSTITUTION.md`
- `docs/canon/AUTH_AND_GATES.md`
- `docs/canon/LAUNCH_FREEZE_LAW.md`
- `docs/canon/ZOMBIE_LEDGER.md`
- `docs/canon/ENDPOINT_CONTRACT.md`
- `docs/canon/ARTIFACT_CONTRACT.md`
- `PROJECT_STATE.md`
- `docs/canon/PENDING_LEDGER.md`
- `docs/canon/OMSR_WAR_CALENDAR__35_55_DAYS.md`
- `docs/canon/EWIMSC.md`

## 2. System Inventory (Counts)
- **Total Unique Routes:** 89
- **Public Product:** 34
- **Lab Internal:** 37
- **Elite Gated:** 13
- **Aliases:** 5
- **Unknown Zombies:** 0 (CLEAN)

## 3. Critical Laws (IDs)
- **LAW_01:** Truth > Guessing (N/A)
- **LAW_02:** API is Lens (No Logic)
- **LAW_03:** No Silent Failures
- **LAW_04:** One Artifacts Root
- **LAW_05:** Founder Override > Forensics
- **LAW_06:** Zero Unknowns (Release Gate)

## 4. Current Gate Modes
- **Auth Mode:** `FOUNDER_AUTH_MODE` (Context Dependent)
- **Autopilot:** Managed by `Autopilot Policy Engine`
- **Release:** `EWIMSC_RELEASE_MODE` (0=Dev, 1=Strict)

## 5. Source Integrity Block
| File Path | Status |
| :--- | :--- |
| `docs/canon/PRINCIPIO_OPERATIVO__MADRE_NODRIZA.md` | TRUSTED |
| `docs/canon/SYSTEM_CONTRACT.md` | TRUSTED |
| `docs/canon/CONTEXT_CORE.md` | TRUSTED |
| `docs/canon/SYSTEM_LAWS.md` | TRUSTED |
| `docs/canon/SYSTEM_ATLAS.md` | TRUSTED |
| `docs/canon/OS_MODULES.md` | TRUSTED |
| `docs/canon/MAP_CORE.md` | TRUSTED |
| `docs/canon/ANTIGRAVITY_CONSTITUTION.md` | TRUSTED |
| `docs/canon/AUTH_AND_GATES.md` | TRUSTED |
| `docs/canon/LAUNCH_FREEZE_LAW.md` | TRUSTED |
| `docs/canon/ZOMBIE_LEDGER.md` | TRUSTED |
| `docs/canon/ENDPOINT_CONTRACT.md` | TRUSTED |
| `docs/canon/ARTIFACT_CONTRACT.md` | TRUSTED |
| `PROJECT_STATE.md` | TRUSTED |
| `docs/canon/PENDING_LEDGER.md` | TRUSTED |
| `docs/canon/OMSR_WAR_CALENDAR__35_55_DAYS.md` | TRUSTED |
| `docs/canon/EWIMSC.md` | TRUSTED |

---

# PART II: HUMAN NARRATIVE
> **Purpose:** Detailed prose and operational context for human operators.

# 1. LA DOCTRINA Y LA IDENTIDAD (EL "POR QUÃ‰")
> QuiÃ©nes somos, quÃ© vendemos y quÃ© estÃ¡ prohibido pensar.

## 1.1 PRINCIPIO OPERATIVO â€” MADRE NODRIZA
*(Source: docs/canon/PRINCIPIO_OPERATIVO__MADRE_NODRIZA.md)*

PRINCIPIO OPERATIVO â€” MADRE NODRIZA

OMSR â€” Operational Market Sniper Runtime
Authority: SUPREME
Status: CANONICAL
Last Sync: Day 45 â€” Feature Phase & Governance Sync
Supersedes: G0.CANON_0 (Bestia Era)

0. DECLARACIÃ“N FUNDACIONAL

Este documento no es marketing.
No es una wishlist.
No es aspiracional.

Este documento es el sistema nervioso operativo de OMSR.

AquÃ­ se define:

lo que el sistema es

cÃ³mo opera

cÃ³mo se protege

cÃ³mo evoluciona

cÃ³mo se presenta al humano

Nada puede ser sellado si no estÃ¡ alineado con este principio.

1. IDENTIDAD DEL SISTEMA (EL ALMA)

OMSR es un Sistema Operativo Institucional de Contexto de Mercado.

Un OS diseÃ±ado para:

describir la realidad del mercado con precisiÃ³n estructural

clasificar estados y regÃ­menes de forma coherente

acumular memoria verificable (Iron OS & Elite)

mantener consistencia semÃ¡ntica a lo largo del tiempo

operar con disciplina, no con hipÃ³tesis

OMSR aprende de la realidad observable, no de suposiciones.

Sus valores fundamentales son:

honestidad estructural

claridad semÃ¡ntica

rigor arquitectÃ³nico

valor sostenido en el tiempo

La confianza no se promete: emerge del diseÃ±o.

2. FILOSOFÃA CANÃ“NICA â€” LEGALIDAD POR DISEÃ‘O

Principio sellado:

Cuando la legalidad estÃ¡ embebida en la arquitectura, no necesita dominar la conversaciÃ³n.

OMSR se define por el valor real que entrega.

La seguridad y la legalidad viven en el sistema mismo, a travÃ©s de:

separaciÃ³n estricta entre contexto y acciÃ³n

Lexicon Guard (stealth, no performativo)

N/A como protecciÃ³n cognitiva

SAFE MODE

Watchdog y Autopilot Governance

Truth Surfaces verificables

El usuario percibe seguridad
porque el sistema es seguro,
no porque se lo repita.

3. CANON SEMÃNTICO (INMUTABLE)

Estas definiciones son ley:

CORE_UNIVERSE (Canonical)

Conjunto mÃ­nimo de instrumentos necesarios para determinar el estado global de riesgo.
TamaÃ±o: 21 sÃ­mbolos (estricto).
Nota histÃ³rica: â€œCORE20â€ es un alias heredado por continuidad tÃ©cnica, no semÃ¡ntica.

Context

DescripciÃ³n estructurada del entorno.

Regime

ClasificaciÃ³n del estado del mercado.

Evidence

Memoria estadÃ­stica descriptiva basada en datos histÃ³ricos comparables.

Confidence

Calidad y cobertura del contexto disponible.

N/A

ProtecciÃ³n cognitiva ante data insuficiente o inconsistente.

SAFE MODE

ProtecciÃ³n operacional ante degradaciÃ³n sistÃ©mica.

4. LEY DEL FUNDADOR

El Founder es la autoridad suprema del sistema.

Cualquier mecanismo de:

control

protecciÃ³n

gobernanza

automatismo

fricciÃ³n

debe tener bypass explÃ­cito para Founder
(X-Founder-Key o Founder Build).

No existe seguridad basada en oscuridad para el Founder.

5. LEY DE LA VERDAD

La verdad solo existe en Artifacts.

El backend no inventa

El API no asume

El frontend no interpreta

El API es un Lens.
Los Artifacts son la realidad.

6. AUTONOMÃA CONTROLADA (AUTONOMY DIAL)

OMSR opera bajo un dial explÃ­cito de autonomÃ­a:

OFF â€” observaciÃ³n pura

SHADOW (Default) â€” anÃ¡lisis y propuesta

SAFE_AUTOPILOT â€” acciÃ³n solo en estabilidad GREEN

THE SURGEON â€” reparaciÃ³n controlada, reversible y auditada

Toda acciÃ³n crea evidencia.

7. TITANIUM LAW â€” SEPARACIÃ“N ABSOLUTA

AGMS piensa.
Autofix ejecuta.
Policy arbitra.

AGMS no ejecuta

Autofix no razona

Policy decide

No hay atajos.
No hay mezcla de roles.

8. LEY DE REFORMA

El cÃ³digo fuente es sagrado.

OMSR:

propone diffs

no modifica cÃ³digo autÃ³nomamente

El runtime es regenerable.

Los artifacts pueden ser reparados solo si:

existe backup

hay auditorÃ­a

el riesgo es controlado

9. ARQUITECTURA POR CAPAS (OS LAYERS)
Layer A â€” SNAPSHOT (SELLADO)

Batch 08:30 ET

Single Source of Truth

Contexto institucional del dÃ­a

Layer B â€” PULSE

Early AM + intraday

Contexto vivo

Nunca reemplaza Snapshot

Layer C â€” PROJECTION (SINAPSIS)

Orquestador central de probabilidad

Synthesis de inputs (News, Options, Macro)

Salida: Context tags + Scenarios (No predicciÃ³n)

Layer D â€” REAL-TIME EVENTS

Eventos â†’ Impacto â†’ Contexto

Event-driven

Layer E â€” IRON (THE MIRROR)

Historia de estados

Replay & Rollback

Indestructibilidad forense

Layer F â€” META WATCHDOG

Supervisor global

SAFE MODE

Salud de capacidades y providers

Drift detection

10. SISTEMA DE ARTEFACTOS (ATOMIC PUBLISH)

OMSR nunca sirve basura parcial.

Regla atÃ³mica:

Write .tmp

Validar schema, hash y lexicon

Promote atomic

Serve

Si falla â†’ Ãºltimo vÃ¡lido + degrade seguro.

11. TRUST SURFACES

Producto = Transparencia

T1 â€” How It Works

QuÃ© es el sistema

CÃ³mo leerlo

QuÃ© significa N/A

T2 â€” System Integrity

Freshness

Capacidades

Providers

SAFE MODE

Lineage (Iron OS)

Sin hype.
Sin miedo.

12. WAR ROOM (FOUNDER COMMAND CENTER)

El War Room es:

operacional

verdad cruda

Founder-only

No es estÃ©tica.
Es mando.

13. HUMAN MODE (ACCESIBILIDAD)

Human Mode:

no cambia hechos

no suaviza incertidumbre

no agrega emociÃ³n

Solo traduce:

Institucional â†’ Claro
Claro â†’ Honesto

14. MONETIZACIÃ“N (SHADOW FIRST)

La monetizaciÃ³n:

no precede al valor

no bloquea seguridad

no rompe confianza

Secuencia natural:

hÃ¡bito

necesidad

confianza

monetizaciÃ³n

15. LEY DE SELLADO

Nada estÃ¡ sellado sin:

Artifact

VerificaciÃ³n observable

UI consistente

Degrade seguro

Watchdog awareness

Implementado â‰  Sellado.

16. FIRMA FINAL

OMSR queda definido como:

Un Sistema Operativo institucional de contexto de mercado
con memoria acumulativa
autonomÃ­a gobernada
verdad auditable
y orgullo de su valor

Sin promesas.
Sin miedo.
Con diseÃ±o.

FIN CANÃ“NICO.

---

## 1.2 SYSTEM CONTRACT
*(Source: docs/canon/SYSTEM_CONTRACT.md)*

# SYSTEM CONTRACT (G0.CANON_1)

**Version:** 1.0 (Genesis)
**Status:** ACTIVE
**Authority:** ANTIGRAVITY

## 1. System Identity
**MarketSniper OS** is a **Descriptive Intelligence Engine**. It processes raw market data into structured JSON artifacts. It does NOT predict the future; it describes the present with extreme fidelity ("Night Finance" doctrine).

## 2. The Contract of Truth
The System Contract defines the immutable boundary between the **Engine** (Backend) and the **Experience** (App/Client).

### 2.1 The "Lens" Doctrine
- The API is a **Reading Lens** over static artifacts.
- The API does **not** think. The Pipeline thinks.
- The UI does **not** calculate. It renders.

### 2.2 The "One Truth" Rule
- There is exactly **ONE** Artifacts Root (`backend/outputs/`).
- All endpoints must serve data derived from this root.
- Side-channels (direct DB access, temp files) are **BANNED**.

## 3. Governance
This contract is the **Supreme Law** of the repository. Changes to this contract require a **G-Level Seal** (Governance Event).

---

## 1.3 CONTEXT CORE
*(Source: docs/canon/CONTEXT_CORE.md)*

CONTEXT CORE â€” MarketSniper AI

Last Updated: 2026-01-28 (Day 47 HF34)
Status: SEALED / CANONICAL
Owner: Founder (Sergio)
Primary Objective: Massive revenue fast, without sacrificing legality, honesty, or long-term scalability.

1) IDENTITY & PRIME DIRECTIVE (NON-NEGOTIABLE)

MarketSniper AI is an institutional-grade market context operating system.

It delivers:

Descriptive market intelligence

Daily context snapshots (Iron OS)

Regime framing and risk classification

Evidence-based historical memory

News and macro interpretation surfaces

Ritualized usage loops (Premarket, Aftermarket, Weekly)

The system is designed to describe reality with structural honesty, preserve coherence over time, and degrade safely when information is insufficient.

Legal safety and trust are not communicated â€” they are architected.

2) BUSINESS OBJECTIVE (INTERNAL)

Primary Goal

Generate massive revenue as fast as possible while preserving:

Legal safety

Intellectual honesty

Long-term scalability

Institutional credibility

Secondary Goals (valid only if the primary goal remains intact):

Cognitive clarity

Reduction of user decision errors

High daily retention through ritualized context

Paid conversion driven by observable value

Pricing Posture

$150/month must feel negligible relative to value delivered.

Trust, recurrence, and clarity are the core retention drivers.

3) SYSTEM POSITIONING (POSITIVE DEFINITION)

MarketSniper AI operates as:

A market context engine

A regime and risk classification system

A descriptive intelligence layer

A memory-driven historical comparison engine

A daily decision-support ritual

Its differentiation comes from architecture, not claims.

4) CORE DESIGN PHILOSOPHY

Architecture-first

Context over ideas

Evidence over narratives

Institutional tone

N/A over guessing

Fail-safe over convenience

Trust over features

Ritual over random usage

If truth cannot be guaranteed, the system degrades gracefully.

5) SYSTEM MENTAL MODEL (HOW IT OPERATES)

MarketSniper AI frames environments and conditions.

It continuously answers:

What regime is active?

What risks dominate?

What dispersion exists?

What historical evidence is relevant?

What information is missing or unreliable?

What is the current confidence level?

What behavioral posture is appropriate?

This model is descriptive, not directive.

6) OPERATING SYSTEM LAYERS (SEALED)

Layer 1 â€” SNAPSHOT
Daily artifact-first market snapshot (Single Source of Truth).

Layer 2 â€” PULSE
Intraday context, drift and anomaly monitoring.

Layer 3 â€” PROJECTION (SYNTHESIS)
Central mixer of Snapshot + Pulse + News. Probabilistic context vs directional prediction.

Layer 4 â€” REAL-TIME EVENTS
News and macro surfaces translated into context.

Layer 5 â€” IRON (THE MIRROR)
State history, replay, and forensic integrity.

Layer 6 â€” META WATCHDOG
System health, provider integrity, drift enforcement, SAFE MODE.

7) PHASE STRUCTURE (SEALED)
Phase B â€” Foundation & Safety âœ… CLOSED

Autonomous pipeline, locks, integrity, universe, governance.

Phase C â€” Intelligence Layer âœ… SEALED

Context, options intelligence, evidence engine, effectiveness, monetization (shadow).

Phase D â€” Elite Ritual Engine âœ… DONE

Premarket, Aftermarket, Weekly rituals and Elite conversion loop.

Phase 5 â€” Feature Phase v1 âœ… COMPLETED

Dashboard, War Room, Iron OS, Elite UX, Watchlist, Shell & Premium.

Phase 6 â€” Institutional Polish (Day 46) âœ… COMPLETED

Phase 11 â€” Projection & News (Day 47) âœ… COMPLETED

Central Brain (Projection Orchestrator), News Engine, On-Demand Area (FROZEN/SEALED).

Phase 12 â€” Transcendence (Future)

Scale, multi-asset expansion, institutional B2B.

8) SEALED GOVERNANCE â€” DOCTRINA OFICIAL

Canonical hierarchy:

PRINCIPIO OPERATIVO â€” MADRE NODRIZA

CONTEXT CORE (this document)

MAP CORE

SYSTEM ATLAS

IDEAS VAULT (non-canonical)

All claims must be production-observable and verifiable.

9) MAJOR SYSTEM PATCHES (HISTORICAL)

Critical fixes and recovery sprints retained for audit lineage.

10) RELATIONSHIP PROTOCOL (AI ASSISTANT)

The assistant operates as:

Long-term strategic co-architect

Guardian of clarity and legality

Architecture-first systems thinker

Proactive value officer

Communication policy:

Code, docs, artifacts: English

Founder communication: Spanish (direct, collaborative)

11) CURRENT PRIORITY (JAN 2026)

Governance alignment complete

Kernel Risk Lanes (D46)

Polish and experiential refinement

North Star:
MarketSniper must feel indispensable.

12) HOW TO RESUME WORK IN ANY NEW CHAT

Assume:

Architecture is correct

Safety is embedded

Ritual system is active

Revenue is the north star

Proceed directly to the next highest-leverage improvement.

END OF CONTEXT CORE

---

## 1.4 SYSTEM LAWS
*(Source: docs/canon/SYSTEM_LAWS.md)*

# SYSTEM LAWS (G0.CANON_1)

**Authority:** SUPREME

## 1. The Law of Truth (N/A > Guessing)
It is better to show **Nothing** (N/A) or an **Error**, than to show a **Guess**.
- The system shall NO LONGER predict without data.
- "Neutral" is a valid state. "Unknown" is a valid state.

## 2. The Law of the Lens
The API Server is a **Lens**, NOT a Brain.
- Logic belongs in the Pipeline.
- The API restricts itself to:
    - Routing
    - Auth
    - Reading JSON
    - Shaping JSON for UI

## 3. The Law of Silence
There shall be **No Silent Failures**.
- If a component fails, it must emit a Trace or a visible Error State.
- Swallow-and-log is BANNED for critical paths.

## 4. The Law of Roots
There is **One** Artifacts Root.
- `backend/outputs/`.
- No stray files in `tmp/` or root.

## 5. The Law of Precedence
1. **Safety** overrides **Performance**.
2. **Truth** overrides **Stability**.
3. **Founder Override** overrides **Everything** (Forensics).

## 6. RELEASE ZERO UNKNOWN LAW
**Governance:** RELEASE BLOCKED
**Trigger:** `EWIMSC_RELEASE_MODE=1` (Tags `v*`, Branches `release/*`)

In Release Mode, the system MUST contain **ZERO (0)** Unknown Zombies.
- Any `UNKNOWN` route detected during a Release build fails the pipeline immediately.
- Exception: In `DEV` mode, unknowns are strictly ratcheted (cannot rise) but allowed if descending (Weekly Gate).

---

# 2. EL MAPA Y LA INFRAESTRUCTURA (EL "DÃ“NDE")
> DÃ³nde viven los datos, quÃ© puertos usamos y cÃ³mo se conectan los cables.

## 2.1 SYSTEM ATLAS
*(Source: docs/canon/SYSTEM_ATLAS.md)*

# SYSTEM ATLAS (G0.CANON_ATLAS)

**Authority:** IMMUTABLE
**Sync Date:** Day 45 (Feature Phase)

## 1. Cloud Infrastructure (GCP)
- **Project ID**: `marketsniper-intel-osr-9953`
- **Region**: `us-central1`

## 2. Compute
### 2.1 Backend (Service Layer)
- **marketsniper-api**: Core Brain (FastAPI).
    - *Roles*: API Server, Autopilot Policy Engine, War Room Dashboard.
    - *Entrypoint*: `Procfile` (`web: python -m backend.api_server`).
    - **Probes Truth**:
        - **External LB probes use:** `/healthz` (Standard Root)
        - **Internal bypass probes use:** `/lab/healthz` (Ops Bypass)
        - **Alias policy:** `/lab/readyz` maps to `/lab/healthz`. All `/lab/*` require `X-Founder-Key` unless defined in `zombie_allowlist.json`.
    - *Features*:
        - **Autofix Control Plane**: Orchestrates healing (Tier 1).
        - **Housekeeper**: Manages data hygiene (Wired: `/lab/os/housekeeper/run`).
        - **Shadow Repair**: Generates/Applies Patches (Propose/Surgeon).
        - **War Room**: Real-time observability interface.
    - *Auth*: Service Account `ms-api-sa`.
    - *Mounts*: `marketsniper-outputs-marketsniper-intel-osr-9953` -> `/app/backend/outputs`.

### 2.2 Pipeline (Worker Layer)
- **market-sniper-pipeline**: Heavy Lifting (Python).
    - *Roles*: Data Ingestion, Pattern Detection, Artifact Generation.
    - *Auth*: Service Account `ms-job-sa`.
    - *Mounts*: Same as API.
    - *Trigger*: 
        - Cloud Schedulers (`ms-full-0830et`, `ms-light-5min`).
        - API (via Autofix/Handoff).

## 3. Autonomous Architecture (AGMS)
### 3.1 Intelligence (The Thinker)
- **AGMS Foundation**: Ingests raw state, builds snapshot.
- **AGMS Intelligence**: Determines coherence, patterns, stability bands.
- **Shadow Recommender**: Proposes actions based on intelligence.
- **Handoff Bridge**: Cryptographically signs proposals for Autofix.

### 3.2 Operations (The Actor)
- **Autopilot Policy Engine**: The "Gatekeeper" (Autonomy Dial).
    - *Modes*: SHADOW, SAFE_AUTOPILOT, FULL_AUTOPILOT.
    - *Input*: Risk Tags + Band + Handoff Token.
    - *Output*: ALLOW/DENY.
- **Autofix Control Plane**: Executes allowed playbooks (e.g., Run Pipeline).
- **Shadow Repair (The Surgeon)**: 
    - *Propose Mode*: Generates diffs for source/contract changes (Human Review).
    - *Surgeon Mode*: Autonomously patches **RUNTIME** artifacts (Low Risk) with Rollback.
- **Iron OS (The Mirror)**:
    - *Roles*: State Management, History, Replay.
    - *Artifacts*: `os_state.json`, `iron_timeline.json`, `lkg_snapshot.json`.

## 4. Persistence
- **Bucket**: `gs://marketsniper-outputs-marketsniper-intel-osr-9953`
- **Volume Method**: GCSFuse (Gen2 Execution Environment).
- **Paths**:
    - Runtime (API/Job): `/app/backend/outputs`
    - Local Dev: `backend/outputs`
- **Artifact Classes**:
    - `full/`, `light/`: Pipeline outputs.
    - `runtime/`: Autonomous State (Ledgers, Policy Snapshots, Handoffs).
    - `seals/`: Immutable cryptographic seals of work.

## 5. Automation
- **Schedulers (Dual Cadence)**:
    - `ms-full-0830et`: 08:30 ET Daily (Full Mode).
    - `ms-light-5min`: Every 5 min (Light Mode).
- **Misfire Monitor**: Embedded in API, detects lock staleness.
- **Housekeeper**: Embedded in API, cleans drift.

## 6. Real-Time Intelligence Arc (Day 40) - COMPLETED
- **Pulse**: Real-time sector/regime state.
- **Sentinel**: Sector heatmap and active monitoring.
- **Freshness**: Real-time logic (1 min - 15 min degrade).
- **Options Report**: `GET /options_report` (Legacy PDF/Text - superseded by `options_context` for logic, but endpoint remains active).

## 7. Iron OS Arc (Day 41) - COMPLETED
- **Iron OS**: The immutable state recorder.
- **Replay Archive**: Time travel for states (Institutional Day Replay).
- **Rollback Ledger**: Founder-gated undo capability.

## 8. Self-Heal & Housekeeper Arc (Day 42) - COMPLETED
- **AutoFix Tier 1**: Deterministic self-repair.
- **Housekeeper**: Auto-clean operational debris.
- **Misfire Tier 2**: Deep-fix logic.

## 9. Elite Arc (Day 43) - COMPLETED
- **Elite Context Memory**:
    - `day_memory.json`: Session memory (4KB/Day).
    - `session_thread_memory.json`: Thread state (12 turns).
    - `context_safety_protocol.json`: Tone & Legal rules.
- **Surface Layer**:
    - **EliteOverlay**: 70/30 Context Shell.
    - **ExplainRouter**: Safe navigation logic.
    - **LayoutPolice**: Debug guard (Founder build).
- **Automation**:
    - **Ritual Scheduler**: Local time-based triggers (Morning, Afternoon, Setup).

## 10. Watchlist & On-Demand (Day 44-47) - FROZEN
- **Watchlist Store**: Local persistence, live chips, easy-add.
- **On-Demand Engine**: Universe-agnostic search (Pipeline/Cache/Offline).
- **Institutional Guard**: Lexicon enforcement on results.
- **Area Capstone**: `docs/canon/ON_DEMAND_AREA_SEAL.md`.

## 11. Feature Phase v1 (Day 45) - COMPLETED
- **Premium Matrix**: Trial/Plus/Elite logic.
- **Share Engine**: Watermarked institutional sharing.
- **Command Center**: Elite-only mystery surface.
- **News & Calendar**: High-fidelity data surfaces.
## 12. Pending Ledger (Day 45) - ACTIVE
- **Pending Ledger**: Single Source of Truth for debt and roadmap.
- **Path**: `docs/canon/PENDING_LEDGER.md`
- **Sync**: Day 45 (Canon Debt Purge)
- **Status**: 10+ Active Items (Voice, Risk Lanes, Procedure, Lock, News Provider, etc.)
- **Machine Index (Radar Input)**: [`outputs/proofs/canon/pending_index_v2.json`](../../outputs/proofs/canon/pending_index_v2.json)
- **UI Surface**: `CanonDebtRadar` (V2.1). Fingerprint Guard + Integrity Check.

## 13. Institutional Polish (Day 46) - COMPLETED
- **Regime Sentinel**: Detailed market regime analysis and discipline buckets.
- **Watchlist 2.0**: Unrestricted memory, snappier UX, auto-clearing snackbars.
- **Widget Standard**: Breathing status accents, unified headers (Neon Cyan).

## 14. News Engine (Day 47) - ARCHITECTURE READY
- **News Demo**: Local deterministic source acting as "Premium Demo".
- **Ranking Engine**: `Macro > Watchlist > General` logic (Rules-Only, No ML).
- **UI**: Flip Cards (`NewsDigestCard`) with Impact Tags.
- **Pending**: Provider Data Pipeline (Open).

## 15. Projection & Context Arc (Day 47 HF17-21) - COMPLETED
- **Projection Orchestrator**: Central mixing engine for probabilistic context.
- **Inputs**: Options (Vol Scale), News (Tags), Macro (Stub).
- **Intraday Series**: Deterministic demo series generator for UI painters.
- **On-Demand Consumption**: Injects projection block into analysis results.

## 16. Infrastructure & Deployment (Day 55) - RESTORED
- **Public API**: `api.marketsniperai.com` (Google Managed SSL + Load Balancer).
- **Hosting**: `marketsniper-intel-osr-9953.web.app` (Firebase Hosting).
- **Rewrite Layer**:
    - `/api/**` -> `marketsniper-api` (Cloud Run) via `firebase.json` rewrite.
    - **Auth**: Service Account `firebase-hosting-sa` with `roles/run.invoker`.
- **Private Guard**: `PublicSurfaceShieldMiddleware` blocks `/lab`, `/forge` on public routes.
- **CORS**: Strict Origin validation (Trusted Domains Only).

## 17. Legacy Content Modules (Reconciled)
*   **Briefing**: `GET /briefing` (Active)
*   **Aftermarket**: `GET /aftermarket` (Active)
*   **Sunday Setup**: `GET /sunday_setup` (Active)
*   **Options Report**: `GET /options_report` (Legacy PDF/Text - superseded by `options_context` for logic, but endpoint remains active).

---

## 2.2 OS MODULES INVENTORY
*(Source: docs/canon/OS_MODULES.md)*

# OS MODULES INVENTORY (Canon)

**Authority:** IMMUTABLE
**Version:** 3.0 (Day 45 - Feature Phase)

> **Days vs Modules**: "Days" represent the history of seals (time). "Modules" represent the operable units of the system (space).

## System Graph

### Operations Chain (The Body)
`Misfire Monitor` â†’ `AutoFix Control Plane` â†’ `Autopilot Policy Engine` â†’ `Execution`
`Housekeeper` â†’ `War Room` (Observer) â†’ `Iron OS` (State)

### AGMS Intelligence Chain (The Mind)
`AGMS Foundation` â†’ `AGMS Intelligence` â†’ `Shadow Recommender` â†’ `Autopilot Handoff`
`Dynamic Thresholds` â†” `Confidence Bands` â†’ `Evidence` â†’ `Options` â†’ `Macro`

### Elite Arc (The Voice)
`Elite Context` â†’ `Explain Router` â†’ `Interactive Shell`

---

## Module Inventory
[See Full Table in Source File - Summary provided in Atlas]
(Refer to original file for specific Python file paths and ports)

---

## 2.3 MAP CORE
*(Source: docs/canon/MAP_CORE.md)*

# MAP CORE (G0.CANON_MAP)

**Authority:** IMMUTABLE
**Sync Date:** Day 47 (Institutional Polish)

## Phase 0: Genesis (Day 00-02) - COMPLETED
- Workspace & Repo Init.
- Contracts (System, Artifact, Endpoint) defined.
- Schema & Lens verification.

## Phase 1: Foundation (Day 03-05) - COMPLETED
- Pipeline Logic (Mock/Stub -> Real).
- Dashboard Logic (Flutter).
- Hardening (Autonomy Spine).

## Phase 2: Autonomy (Day 06-08) - COMPLETED
- Infrastructure Hydration (GCP Business).
- Persistence (GCSFuse).
- Scheduler & Misfire Monitor (Autoheal).

## Phase 3: The Brain (Day 13-28) - COMPLETED
- **Modular Refactor:** AGMS Foundation, Intelligence, Ops separation.
- **Autopilot Policy:** Autonomy Dial (SHADOW, SAFE_AUTOPILOT).
- **Playbooks:** Registry v2.0 with Coverage Scanning.

## Phase 4: Self-Repair (Day 29-31) - COMPLETED
- **Shadow Observation:** Validating decisions without action.
- **SAFE_AUTOPILOT:** Automated execution of Tier-1 Playbooks (Green Band).
- **The Surgeon:** Runtime Self-Repair (Low Risk Patching) with Rollback.

## Phase 5: Transcendence (Day 32-35) - COMPLETED
- **The Immune System:** Shadow Sanitize v1.
- **The Dojo:** Offline simulation & tuning.
- **The Black Box:** Forensic indestructibility.

## Phase 6: Features & Persistence (Day 36-39) - COMPLETED
- **Language Law:** 100% English normalization.
- **Persistence v2:** War Calendar + Project State synchronization.
- **Universe v3:** Core/Extended/Overlay logic + Governance surfaces.

## Phase 7: Elite Arc (Day 40-43) - COMPLETED
- **Real-Time Intelligence:** Tape, Pulse, Sentinel, Synthesis layers.
- **Iron OS:** Forensics, LKG, State History, Replay Integrity.
- **Self-Heal v2:** AutoFix, Housekeeper, Lock Reasons, Red Button surfaces.
- **Elite Experience:** Overlay, Mentor tone, Explain Router, Safety Layer.
- **Layout Police:** Infrastructure Guard for strict layout discipline.

## Phase 8: Watchlist & On-Demand (Day 44) - COMPLETED
- **Watchlist Store**: Local persistence, live chips, easy-add.
- **On-Demand Engine**: Universe-agnostic search (Pipeline/Cache/Offline).
- **Institutional Guard**: Lexicon enforcement on results.

## Phase 9: Feature Phase v1 (Day 45) - COMPLETED
- **Premium Matrix**: Trial/Plus/Elite logic.
- **Share Engine**: Watermarked institutional sharing.
- **Command Center**: Elite-only mystery surface.
- **News & Calendar**: High-fidelity data surfaces.
- **Canon Debt Purge**: Pending Ledger & Closure Hook V1.

## Phase 10: Institutional Polish (Day 46) - COMPLETED
- **Regime Sentinel**: Detail view, probabilistic buckets, discipline rules.
- **Watchlist Micro-Polish**: UX refinement, SnackBar fix, Premium typography.
- **Widget Polish**: Breathing accents, unified headers (Neon Cyan).

## Phase 11: News & Projection Arc (Day 47) - COMPLETED
- **News Engine**: `LocalDemoNewsDigestSource`, Ranking, Flip Cards.
- **Projection Orchestrator**: Central brain for signals-free context synthesis.
- **Intraday Series**: Deterministic demo series for high-res charting.
- **On-Demand Area (SEALED)**: Full Source Ladder, 3-Tier Gating, Cost Policy.


## Phase 13: Elite Arc v2 (Day 48-49) - COMPLETED
- **Sinapsis Layer:** Central Brain, Attribution Engine, Reliability Ledger.
- **Elite Shell v2:** Glassmorphism, 2x3 Ritual Grid, Notifications.
- **Memory Engine:** Longitudinal User Reflection (JSONL + Similar Scenario).
- **Ritual Policy:** Deterministic Monday Free Window, Briefings.
- **Governance:** Full Hardening & Area Seal.

## Phase 14: Future Expansion

---

# 3. LA CONSTITUCIÃ“N Y GOBERNANZA (EL "CÃ“MO")
> Las reglas del juego para saber si un cÃ³digo es legal o ilegal.

## 3.1 ANTIGRAVITY CONSTITUTION
*(Source: docs/canon/ANTIGRAVITY_CONSTITUTION.md)*

ANTIGRAVITY CONSTITUTION

Status: SUPREME LAW
Enforcement: AUTOMATED (verify_project_discipline.py)

1. PRIME DIRECTIVES (NON-NEGOTIABLE)

One Step = One Seal
No task concludes without a verifiable SEAL_*.md.

Core OS Changes Require Release Discipline
Any modification under backend/os_ops/ MUST include RELEASE_CHECKLIST.md evidence.

Separation of Powers

AGMS reasons

Autofix executes

Policy arbitrates
No role leakage is allowed.

Source is Sacred. Runtime is Regenerable

Code is permanent

Runtime artifacts are ephemeral

outputs/runtime/ is NEVER committed

Canon is Law
If code conflicts with Canon, code is wrong.

Structural Failure Protocol (LKG First)
If any syntax or AST-level failure occurs (e.g. parser errors, missing build(), unmatched braces):

Immediate rollback to Last Known Good (LKG)

Re-apply changes incrementally

Verify after each increment
ðŸš« Patch-on-top recovery is PROHIBITED in this state.

2. MANDATORY READ SET (SOURCE OF TRUTH)

Before starting any non-trivial task, Antigravity MUST respect these if present:

Canon & System

docs/canon/ANTIGRAVITY_CONSTITUTION.md

docs/canon/PRINCIPIO_OPERATIVO__MADRE_NODRIZA.md

docs/canon/SYSTEM_ATLAS.md

docs/canon/OS_MODULES.md

docs/canon/PENDING_LEDGER.md

Machine & Policy

os_registry.json

os_playbooks.yml

os_autopilot_policy.json

os_kill_switches.json

UI Truth

market_sniper_app/lib/theme/app_colors.dart

market_sniper_app/lib/theme/app_typography.dart

3. NON-NEGOTIABLE DISCIPLINE
A. UI & FRONTEND

ðŸš« PROHIBITED: Hardcoded colors (Color(0x...), Colors.red, etc.)

âœ… Use AppColors.semanticToken

ðŸš« PROHIBITED: Custom TextStyle

âœ… Use AppTypography.*

UI must be semantic, token-driven, and theme-authoritative.

B. LARGE FILE SAFETY (â‰¥ 300 LOC)

For Dart files over 300 LOC, ONE of the following is mandatory:

Block-level edits only (clearly delimited), OR

Git rollback to LKG + incremental re-application

ðŸš« PROHIBITED:
Multi-feature patching without intermediate compile/verify steps.

Minimum requirement:

Compile / analyze after each structural change

C. RUNTIME & OPS HYGIENE

ðŸš« PROHIBITED: Committing outputs/runtime/

âœ… MANDATORY: Proof artifacts go in outputs/proofs/

âœ… MANDATORY: Update PROJECT_STATE.md at task end

âœ… MANDATORY: Create a SEAL in outputs/seals/

Artifacts must be atomic, verifiable, and traceable.

D. CANON DEBT (PENDING LAW â€” STRICT)

If a SEAL contains any of the following:

â€œNext Stepsâ€

â€œFutureâ€

â€œPlannedâ€

â€œPendingâ€

â€œUpgradeâ€

Then ALL are mandatory:

Update docs/canon/PENDING_LEDGER.md

Update the corresponding pending index JSON
(e.g. outputs/proofs/canon/pending_index_*.json)

Pending Closure Hook MUST include:

Resolved Pending Items

New Pending Items

âŒ FAILURE CONDITION:
If pending artifacts are not updated â†’ SEAL IS INVALID

4. FINISH PROTOCOL (MANDATORY ORDER)

Every task ends with ALL of the following:

Update PROJECT_STATE.md

Run python tool/auto_stage_canon_outputs.py

Run verify_project_discipline.py

Create outputs/seals/SEAL_*.md

Generate proof artifacts in outputs/proofs/

No exceptions. No shortcuts.

5. OPERATING PRINCIPLE (CLOSING LAW)

Antigravity exists to extend the Founderâ€™s intent with:

Discipline

Memory

Rigor

No hype.
No shortcuts.
Only systems that endure.

ðŸ“Œ EFFECTIVE DATE

Original Constitution + Updates consolidated and enforced as of 2026-02-05

---

## 3.2 AUTH & GATES
*(Source: docs/canon/AUTH_AND_GATES.md)*

# AUTH & GATES CANON (G0.CANON_1)

**Authority:** IMMUTABLE

## 1. Headers Contract
The following headers are authoritative.

| Header | Purpose | Producer | Persistence |
| :--- | :--- | :--- | :--- |
| **X-Founder-Key** | High-privilege access | Client (Founder) | Ephemeral (Session) |
| **X-Client-Build** | Deployment Tracking | Client (App) | Logged |
| **X-Founder-Trace** | Forensic Visibility | Backend | Response Only |

## 2. Environment Flags (Backend)
- `FOUNDER_BUILD`: (Bool) Enables/Disables trace injection.
- `FOUNDER_AUTH_MODE`: (Enum: `STRICT`, `OPEN`, `OFF`) Controls `/lab/` access.
    - **STRICT**: Requires `X-Founder-Key` match.
    - **OPEN**: (Dev Only) Allows bypass.
    - **OFF**: All `/lab/` endpoints return 404.

## 3. The "Founder Mode" Law
Founder Mode is a **System Override**, not a Feature.
- It must **never** be exposed to an end-user.
- It is triggered **only** by explicit headers or environment flags.
- When active, it forces `Visual Transparency` (ErrorCards instead of empty space).

## 4. Default Fail Behaviors
- **Public API**: Fail Open (Serve stale data if live is missing).
- **Ops API**: Fail Hidden (Return 404 if unauthorized).
- **Entitlement**: Fail Closed (Deny access if DB is down).

### 4.1 LAB_INTERNAL Unauthorized Failure Mode (Fail-Hidden)
**Rule:** Unauthorized access to `LAB_INTERNAL` endpoints must be indistinguishable from a missing route.
- **Fail-Hidden (404 Not Found)** is REQUIRED for all `LAB_INTERNAL` routes when `X-Founder-Key` is missing or invalid.
- **Fail-Closed (403 Forbidden)** is explicitly BANNED for these routes to prevent enumeration.
- **Traces:** A 404 trace may be logged internally, but the external response must be empty/standard 404.

## 5. Elite Gating (Cost/Write)
Certain Elite endpoints are gated to prevent cost abuse or unauthorized state modification.
**Policy:** `REQUIRE_ELITE_OR_FOUNDER`
- **Authorized:** `X-Founder-Key` override OR `Elite Entitlement` active.
- **Fail Behavior:** `403 Forbidden` (Fail-Closed).
- **Body:** `{"detail":"NOT_AUTHORIZED"}`

---

## 3.3 LAUNCH FREEZE LAW
*(Source: docs/canon/LAUNCH_FREEZE_LAW.md)*

# LAUNCH FREEZE LAW (Day 30.1)

**Authority:** SUPREME (Launch Control)
**Status:** ACTIVE

## 1. Definition of "Core OS"
The "Core OS" represents the autonomous nervous system of MarketSniper. Modification of these components carries existential risk.

**Core OS includes:**
1.  **Autopilot Policy**: The decision engine (`autopilot_policy_engine.py`, `os_autopilot_policy.json`).
2.  **The Surgeon**: Runtime Self-Repair logic (`shadow_repair.py`).
3.  **Playbook Registry**: The library of allowed actions (`os_playbooks.yml`, `autofix_control_plane.py`).
4.  **Module Registry**: The system map (`os_registry.json`).
5.  **Pipeline Controller**: The data flow orchestrator (`pipeline_controller.py`).
6.  **Core Gates**: The safety barriers (`core_gates.py`).
7.  **War Room**: The observability plane (`war_room.py`).

## 2. The Law of Freeze
**"No Core OS component may be modified without a specific, approved Release Protocol."**

Any modification to Core OS requires:
1.  **Playbook**: A clear plan (Implementation Plan).
2.  **Checklist**: Mandatory adherence to `RELEASE_CHECKLIST.md`.
3.  **Verification**: Automated proof of safety (`verify_*.py`).
4.  **Seal**: A cryptographic sign-off (`SEAL_*.md`).

## 3. The Law of Kill Switches
The system must possess absolute "analog" overrides (Kill Switches) that function logically above the AI's cognitive layer.
- **AUTOPILOT_ENABLED**: Logic gate for *any* autonomous action.
- **SURGEON_RUNTIME_ENABLED**: Specific gate for runtime file modification.
- **PIPELINE_RUN_ENABLED**: Master valve for data processing.
- **FOUNDER_OVERRIDE**: Absolute right of the human pilot to bypass all gates.

## 4. Automation Enforcement
This law is enforced by code (`freeze_enforcer.py`). The system shall refuse to SEAL or Deploy if the Core OS definition is violated or if Kill Switches are missing.

---

# 4. LA REALIDAD OPERATIVA (EL "QUÃ‰")
> Endpoints reales, artefactos de datos y estado zombie actual.

## 4.1 ZOMBIE LEDGER (TRIAGED)
*(Source: docs/canon/ZOMBIE_LEDGER.md)*

Generated: 2026-02-06
Unique Routes: 89
Public/Product: 34
LAB/Internal: 37
Elite/Gated: 13
Aliases: 5
Unknown Zombies: 0

(See original file for full classification list)

## 4.2 ENDPOINT CONTRACT
*(Source: docs/canon/ENDPOINT_CONTRACT.md)*

# ENDPOINT CONTRACT (G0.CANON_1)

**Authority:** IMMUTABLE
**Sync Date:** Day 31 (The Surgeon)

## 1. Endpoint Classification

### 1.1 Public (Core)
*Accessible to all clients. Fail-safe behavior required.*
(Examples: /context, /dashboard, /pulse, /misfire)

### 1.2 Operations & War Room (Ops)
*High-privilege. STRICT isolation.*
(Examples: /lab/war_room, /lab/run_pipeline)
**Gating:** X-Founder-Key
**Fail Behavior:** 404 (Hidden)

### 1.3 Intelligence (AGMS)
*Traceability into the "Thinking" layer.*
(Examples: /elite/chat, /agms/intelligence)

## 2. Response Standards
- **Success**: 200 OK.
- **Maintenance**: 503 Service Unavailable (with `Retry-After`).
- **Hidden**: 404 Not Found (for sensitive ops endpoints w/o Key).
- **Structure**: All JSON responses must be wrapped (no raw lists).

## 4.3 ARTIFACT CONTRACT
*(Source: docs/canon/ARTIFACT_CONTRACT.md)*

# ARTIFACT CONTRACT (G0.CANON_1)

**Authority:** IMMUTABLE
**Sync Date:** Day 31 (The Surgeon)

## 1. Artifacts Root
All system artifacts must reside in the canonical **Artifacts Root**.
*   **Local Dev**: `backend/outputs/`
*   **Cloud Run**: `/app/backend/outputs`
*   **Persistence**: GCSFuse mounted bucket.

## 2. Core Artifacts Inventory
(See original file for table of manifest, runtime, and feature artifacts)

## 3. Laws of Production
1. **Atomic Write**: All artifacts must be written atomically (`.tmp` -> `rename`).
2. **Schema Versioning**: All core artifacts must contain a `"schema_version"` field.
3. **No Partial Writes**: An artifact is either complete or it does not exist.
4. **Backup First (Surgeon Law)**: Any runtime repair MUST backup the target first (`.bak`).

---

# 5. EL ESTADO Y LA DEUDA (EL "CUÃNDO")
> QuÃ© falta, dÃ³nde nos quedamos y el calendario de batalla.

## 5.1 PROJECT STATE
*(Source: PROJECT_STATE.md)*

**Status:** PHASE 8: INFRASTRUCTURE RESTORATION (DAY 55) - SEALED
**Active Rule:** Core OS Freeze Law is ACTIVE.

**Recent Major Milestones:**
- Day 55: D55.16 War Room Visibility Restore (Sealed)
- Day 56: D56.01 Unified Snapshot Protocol Implementation (Sealed)
- Day 56: D56.01.10 Cloud Run Deploy (Green) (Sealed)
- D59 Campaign: Lab Internal Promotion, Elite Classification, Zero Unknown Victory.

(Refer to PROJECT_STATE.md for full history)

## 5.2 PENDING LEDGER
*(Source: docs/canon/PENDING_LEDGER.md)*

# PENDING LEDGER (CANON DEBT PURGE)

**Authority:** CANONICAL
**Status:** ACTIVE
**Validation:** `verify_project_discipline.py`

This ledger is the **Single Source of Truth** for all "Planned", "Future", "Pending", and "Debt" items detected in the repository.

1. Strategic Roadmap (War Calendar)
- PEND_INTEL_VOICE_V2 (Open)
- PEND_MSK_RISK_LANES (Open)
- PEND_MSK_PROC_RECEIPT (Open)
- PEND_MSK_ABUSE_SCORE (Open)
- PEND_MSK_GLOBAL_LOCK (Open)

2. Feature Stubs & Deferred Scope
- PEND_UI_OPTIONS_L3 (Open)
- PEND_INTEL_PROJECTION_LANE_EVIDENCE_ARTIFACT (Open)
- PEND_BACK_VOICE_MVP (Open)
- PEND_UI_WATCHLIST_MSG (Open)
- PEND_UI_SESSION_LOGIC (Open)
- PEND_INTEL_SECTOR_SPIKE_BASELINE (Open)
- PEND_OPS_FLUTTER_ANALYZE_BASELINE_CLEANUP (Open)

(Resolved items omitted for brevity)

## 5.3 WAR CALENDAR (35-55 DAYS)
*(Source: docs/canon/OMSR_WAR_CALENDAR__35_55_DAYS.md)*

**Authority:** STRATEGIC (Canonical)
**Status:** CANONICAL (Forward Only)

Governance Rule: Any Day marked as SEALED (PASS) must have a `SEAL_DAY_XX_*.md` artifact.

**Phase Status:**
- PHASE 0: Boot + Truth + LKG [COMPLETED]
- PHASE 1: Persistence + Cadence [COMPLETED]
- PHASE 2: Unbreakable Operability [COMPLETED]
- PHASE 3: "Beast+" Product [COMPLETED]
- PHASE 4: Self-Repair (Surgeon) [COMPLETED]
- PHASE 5: Transcendence (Immune/Dojo/BlackBox) [COMPLETED]
- PHASE 6: Features & Persistence [COMPLETED]
- PHASE 7: Elite Arc [COMPLETED]
- PHASE 8: Infrastructure Restoration (Day 55) [COMPLETED]

**Specific Recent Completions:**
- D53: War Room Structural Refactor
- D55: Infrastructure Restoration (Full Redeploy, Public Access, Hosting Rewrite)
- D56: Unified Snapshot Protocol
- D59: Unknown Resolution Campaign

## 5.4 EWIMSC (TRUTH REGISTRY)
*(Source: docs/canon/EWIMSC.md)*

# EWIMSC â€” SEALS-FIRST TOTAL TRUTH REGISTRY

> **CORE TRUTH HARNESS (D57)**
> To verify compliance with this registry, run:
> `powershell -ExecutionPolicy Bypass -File tools/ewimsc/ewimsc_run.ps1`
>
> **Verdict:** ONE COMMAND = ONE VERDICT (PASS/FAIL).

**Extracted from D56 Audit (Seals-First)**
**Total Claims:** ~500

(See `EWIMSC.md` for the exhaustive list of 500+ verifiction points)

---
**END OF MASTER CONTEXT PACK**
